machine:
  node:
    version:
      0.10.28

dependencies:
  pre:
    # install the dummy driver + configuration
    - sudo apt-get update && sudo apt-get install -y xserver-xorg-video-dummy
    - wget http://xpra.org/xorg.conf
    # kill the old server
    - sudo killall Xvfb
    # start a new one.
    - Xorg -noreset +extension GLX +extension RANDR +extension RENDER -logfile ./10.log -config ./xorg.conf $DISPLAY.0:
        background: true
    # wait a bit for it to start.
    - sleep 2
    # set the resolution to something sane.
    - xrandr --output default --mode 1280x1024

test:
  pre:
    - npm start:
        background: true
    - sleep 5
  override:
    - npm run test-single-run
    - npm run protractor
